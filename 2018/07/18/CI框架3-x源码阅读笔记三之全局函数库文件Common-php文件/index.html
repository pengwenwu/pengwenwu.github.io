<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件 | Pena&#39;s Blog | 莫道君行早，更有早行人</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="PHP,CodeIgniter">
    <meta name="description" content="全局函数库Common.phpCommon.php文件定义了一系列的全局函数，具有最高的加载优先权   function_exists()的使用是为了避免重复定义 1require_once(BASEPATH.&apos;core/Common.php&apos;); is_php()确定当前PHP版本是否等于或大于提供的值   123456789101112131415161718192021if ( ! func">
<meta name="keywords" content="PHP,CodeIgniter">
<meta property="og:type" content="article">
<meta property="og:title" content="CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件">
<meta property="og:url" content="https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/index.html">
<meta property="og:site_name" content="Pena&#39;s Blog">
<meta property="og:description" content="全局函数库Common.phpCommon.php文件定义了一系列的全局函数，具有最高的加载优先权   function_exists()的使用是为了避免重复定义 1require_once(BASEPATH.&apos;core/Common.php&apos;); is_php()确定当前PHP版本是否等于或大于提供的值   123456789101112131415161718192021if ( ! func">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-07-18T15:45:13.101Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件">
<meta name="twitter:description" content="全局函数库Common.phpCommon.php文件定义了一系列的全局函数，具有最高的加载优先权   function_exists()的使用是为了避免重复定义 1require_once(BASEPATH.&apos;core/Common.php&apos;); is_php()确定当前PHP版本是否等于或大于提供的值   123456789101112131415161718192021if ( ! func">
    
        <link rel="alternate" type="application/atom+xml" title="Pena&#39;s Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.jpg">
    <link rel="stylesheet" href="/css/style.css?v=1.7.1">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">pengwenwu</h5>
          <a href="mailto:pww932589183@163.com" title="pww932589183@163.com" class="mail">pww932589183@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/pengwenwu" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-07-18T15:44:40.000Z" itemprop="datePublished" class="page-time">
  2018-07-18
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/后端/">后端</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#全局函数库Common-php"><span class="post-toc-number">1.</span> <span class="post-toc-text">全局函数库Common.php</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#is-php"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">is_php()</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#is-really-writable"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">is_really_writable()</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#amp-load-class"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">&amp;load_class()</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#is-loaded"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">is_loaded</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#get-config"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">get_config</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#config-item"><span class="post-toc-number">1.6.</span> <span class="post-toc-text">config_item</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#get-mimes"><span class="post-toc-number">1.7.</span> <span class="post-toc-text">get_mimes</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#is-https"><span class="post-toc-number">1.8.</span> <span class="post-toc-text">is_https</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#is-cli"><span class="post-toc-number">1.9.</span> <span class="post-toc-text">is_cli</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#show-error"><span class="post-toc-number">1.10.</span> <span class="post-toc-text">show_error</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#show-404"><span class="post-toc-number">1.11.</span> <span class="post-toc-text">show_404</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#log-message"><span class="post-toc-number">1.12.</span> <span class="post-toc-text">log_message</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#set-status-header"><span class="post-toc-number">1.13.</span> <span class="post-toc-text">set_status_header</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#error-handler、-exception-handler、-shutdown-handler"><span class="post-toc-number">1.14.</span> <span class="post-toc-text">_error_handler、_exception_handler、_shutdown_handler</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#remove-invisible-characters"><span class="post-toc-number">1.15.</span> <span class="post-toc-text">remove_invisible_characters</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#html-escape"><span class="post-toc-number">1.16.</span> <span class="post-toc-text">html_escape</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#stringify-attributes"><span class="post-toc-number">1.17.</span> <span class="post-toc-text">_stringify_attributes</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#function-usable"><span class="post-toc-number">1.18.</span> <span class="post-toc-text">function_usable</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-07-18 23:44:40" datetime="2018-07-18T15:44:40.000Z"  itemprop="datePublished">2018-07-18</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/后端/">后端</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="全局函数库Common-php"><a href="#全局函数库Common-php" class="headerlink" title="全局函数库Common.php"></a>全局函数库Common.php</h1><p>Common.php文件定义了一系列的全局函数，具有最高的加载优先权  </p>
<p><code>function_exists()</code>的使用是为了避免重复定义</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">require_once</span>(BASEPATH.<span class="string">'core/Common.php'</span>);</span><br></pre></td></tr></table></figure>
<h2 id="is-php"><a href="#is-php" class="headerlink" title="is_php()"></a>is_php()</h2><p>确定当前PHP版本是否等于或大于提供的值  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'is_php'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Determines if the current version of PHP is equal to or greater than the supplied value</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	bool	TRUE if the current version is $version or higher</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">is_php</span><span class="params">($version)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $_is_php;</span><br><span class="line">		$version = (string) $version;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ( ! <span class="keyword">isset</span>($_is_php[$version]))</span><br><span class="line">		&#123;</span><br><span class="line">			$_is_php[$version] = version_compare(PHP_VERSION, $version, <span class="string">'&gt;='</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> $_is_php[$version];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="is-really-writable"><a href="#is-really-writable" class="headerlink" title="is_really_writable()"></a>is_really_writable()</h2><p>测试文件可写性  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'is_really_writable'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Tests for file writability</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * is_writable() returns TRUE on Windows servers when you really can't write to</span></span><br><span class="line"><span class="comment">	 * the file, based on the read-only attribute. is_writable() is also unreliable</span></span><br><span class="line"><span class="comment">	 * on Unix servers if safe_mode is on.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@link</span>	https://bugs.php.net/bug.php?id=54709</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	bool</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">is_really_writable</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="comment">// 兼容linux/Unix和windows系统</span></span><br><span class="line">		<span class="comment">// 可以通过分隔符判断当前系统是linux，直接调用方法判断文件是否可写</span></span><br><span class="line">		<span class="keyword">if</span> (DIRECTORY_SEPARATOR === <span class="string">'/'</span> &amp;&amp; (is_php(<span class="string">'5.4'</span>) <span class="keyword">OR</span> ! ini_get(<span class="string">'safe_mode'</span>)))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> is_writable($file);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Windows系统</span></span><br><span class="line">		<span class="keyword">if</span> (is_dir($file))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 如果是目录，则创建一个随机命名的文件</span></span><br><span class="line">			$file = rtrim($file, <span class="string">'/'</span>).<span class="string">'/'</span>.md5(mt_rand());</span><br><span class="line">			<span class="comment">// 如果文件无法创建，则返回不可写</span></span><br><span class="line">			<span class="comment">// 这里fopen参数的mode多加了'b'，是强制使用二进制的意思</span></span><br><span class="line">			<span class="keyword">if</span> (($fp = @fopen($file, <span class="string">'ab'</span>)) === <span class="keyword">FALSE</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			fclose($fp);</span><br><span class="line">			<span class="comment">// 删除刚才的文件</span></span><br><span class="line">			@chmod($file, <span class="number">0777</span>);</span><br><span class="line">			@unlink($file);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span> ( ! is_file($file) <span class="keyword">OR</span> ($fp = @fopen($file, <span class="string">'ab'</span>)) === <span class="keyword">FALSE</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// 非文件或者文件无法打开</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 关闭句柄</span></span><br><span class="line">		fclose($fp);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="amp-load-class"><a href="#amp-load-class" class="headerlink" title="&amp;load_class()"></a>&amp;load_class()</h2><p>这个函数充当单例。如果所请求的类不存在，则实例化并将其设置为静态变量。如果先前实例化了变量，则返回该变量。  </p>
<ul>
<li><code>引用返回</code>：该函数返回的是一个class实例的引用，任何对该实例的改变，都会影响下一次函数的调用结果  </li>
<li>也是通过内部的<code>static</code>关键字进行缓存已经加载的类的实例，实现方式类似于单例模式  </li>
<li>优先查找APPPATH和BASEPATH，最后才从$directory中查找类。如果存在同名类，最终加载自定义的扩展类    </li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> &amp;<span class="title">load_class</span><span class="params">($class, $directory = <span class="string">'libraries'</span>, $param = NULL)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">static</span> $_classes = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 判断当前类是否存在，已存在，则返回</span></span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">isset</span>($_classes[$class]))</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> $_classes[$class];</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	$name = <span class="keyword">FALSE</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 首先查找本地 application/directory 文件夹</span></span><br><span class="line">	<span class="comment">// 然后是本机的 system/directory 文件夹</span></span><br><span class="line">	<span class="comment">// 优先使用app自定义类</span></span><br><span class="line">	<span class="keyword">foreach</span> (<span class="keyword">array</span>(APPPATH, BASEPATH) <span class="keyword">as</span> $path)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (file_exists($path.$directory.<span class="string">'/'</span>.$class.<span class="string">'.php'</span>))</span><br><span class="line">		&#123;</span><br><span class="line">			$name = <span class="string">'CI_'</span>.$class;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (class_exists($name, <span class="keyword">FALSE</span>) === <span class="keyword">FALSE</span>)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">require_once</span>($path.$directory.<span class="string">'/'</span>.$class.<span class="string">'.php'</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 自定义的拓展类是否存在，加载</span></span><br><span class="line">	<span class="keyword">if</span> (file_exists(APPPATH.$directory.<span class="string">'/'</span>.config_item(<span class="string">'subclass_prefix'</span>).$class.<span class="string">'.php'</span>))</span><br><span class="line">	&#123;</span><br><span class="line">		$name = config_item(<span class="string">'subclass_prefix'</span>).$class;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (class_exists($name, <span class="keyword">FALSE</span>) === <span class="keyword">FALSE</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">require_once</span>(APPPATH.$directory.<span class="string">'/'</span>.$name.<span class="string">'.php'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 未找到该类</span></span><br><span class="line">	<span class="keyword">if</span> ($name === <span class="keyword">FALSE</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// <span class="doctag">Note:</span> We use exit() rather than show_error() in order to avoid a</span></span><br><span class="line">		<span class="comment">// self-referencing loop with the Exceptions class</span></span><br><span class="line">		set_status_header(<span class="number">503</span>);</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">'Unable to locate the specified class: '</span>.$class.<span class="string">'.php'</span>;</span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">5</span>); <span class="comment">// EXIT_UNK_CLASS</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 记录刚刚加载过的类</span></span><br><span class="line">	is_loaded($class);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 实例化</span></span><br><span class="line">	$_classes[$class] = <span class="keyword">isset</span>($param)</span><br><span class="line">		? <span class="keyword">new</span> $name($param)</span><br><span class="line">		: <span class="keyword">new</span> $name();</span><br><span class="line">	<span class="keyword">return</span> $_classes[$class];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="is-loaded"><a href="#is-loaded" class="headerlink" title="is_loaded"></a>is_loaded</h2><p>用来追踪被加载过的类  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'is_loaded'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Keeps track of which libraries have been loaded. This function is</span></span><br><span class="line"><span class="comment">	 * called by the load_class() function above</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	array</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> &amp;<span class="title">is_loaded</span><span class="params">($class = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $_is_loaded = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ($class !== <span class="string">''</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$_is_loaded[strtolower($class)] = $class;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> $_is_loaded;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="get-config"><a href="#get-config" class="headerlink" title="get_config"></a>get_config</h2><p>记载主要的config.php文件  </p>
<p>这个函数允许我们抓取配置文件，即使是配置类还没有被实例化  </p>
<p><code>类型约束</code>：php5可以使用类型约束，函数的参数可以指定必须为对象（在函数原型里面指定类的名字），接口，数组（php5.1起），回调callback（php5.4起）。<br>自php7起，新增标量类型声明：字符串string，整数int，浮点数float，布尔值bool。一般不太会用到，除非是<code>依赖注入</code>的设计模式中  </p>
<p>需要注意的几点：</p>
<ul>
<li>函数只加载主配置文件，不会加载其他配置文件（这意味着，如果添加了其他的配置文件，在框架预备完毕之前，不会读取你的配置文件）。在Config组件实例化之前，所有读取主配置文件的工作都由该函数完成  </li>
<li>该函数支持动态运行的过程中修改Config.php中的条目（配置信息只可能修改一次，因为该函数也有static变量做缓存，若缓存存在，则直接返回配置）  </li>
<li>会同时加载environment下的配置文件，即会覆盖先前查找的config.php中相同的属性  </li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'get_config'</span>))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Loads the main config.php file</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * This function lets us grab the config file even if the Config class</span></span><br><span class="line"><span class="comment">	 * hasn't been instantiated yet</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	array</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	array</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> &amp;<span class="title">get_config</span><span class="params">(Array $replace = array<span class="params">()</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $config;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($config))</span><br><span class="line">		&#123;</span><br><span class="line">			$file_path = APPPATH.<span class="string">'config/config.php'</span>;</span><br><span class="line">			$found = <span class="keyword">FALSE</span>;</span><br><span class="line">			<span class="keyword">if</span> (file_exists($file_path))</span><br><span class="line">			&#123;</span><br><span class="line">				$found = <span class="keyword">TRUE</span>;</span><br><span class="line">				<span class="keyword">require</span>($file_path);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Is the config file in the environment folder?</span></span><br><span class="line">			<span class="keyword">if</span> (file_exists($file_path = APPPATH.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/config.php'</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">require</span>($file_path);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">elseif</span> ( ! $found)</span><br><span class="line">			&#123;</span><br><span class="line">				set_status_header(<span class="number">503</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'The configuration file does not exist.'</span>;</span><br><span class="line">				<span class="keyword">exit</span>(<span class="number">3</span>); <span class="comment">// EXIT_CONFIG</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="comment">// Does the $config array exist in the file?</span></span><br><span class="line">			<span class="keyword">if</span> ( ! <span class="keyword">isset</span>($config) <span class="keyword">OR</span> ! is_array($config))</span><br><span class="line">			&#123;</span><br><span class="line">				set_status_header(<span class="number">503</span>);</span><br><span class="line">				<span class="keyword">echo</span> <span class="string">'Your config file does not appear to be formatted correctly.'</span>;</span><br><span class="line">				<span class="keyword">exit</span>(<span class="number">3</span>); <span class="comment">// EXIT_CONFIG</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Are any values being dynamically added or replaced?</span></span><br><span class="line">		<span class="keyword">foreach</span> ($replace <span class="keyword">as</span> $key =&gt; $val)</span><br><span class="line">		&#123;</span><br><span class="line">			$config[$key] = $val;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> $config;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="config-item"><a href="#config-item" class="headerlink" title="config_item"></a>config_item</h2><p>获取配置数组中具体的值<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'config_item'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Returns the specified config item</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	mixed</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">config_item</span><span class="params">($item)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $_config;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($_config))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// references cannot be directly assigned to static variables, so we use an array</span></span><br><span class="line">			$_config[<span class="number">0</span>] =&amp; get_config();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">isset</span>($_config[<span class="number">0</span>][$item]) ? $_config[<span class="number">0</span>][$item] : <span class="keyword">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="get-mimes"><a href="#get-mimes" class="headerlink" title="get_mimes"></a>get_mimes</h2><p>此函数返回从配置/ mimes.php MIME类型的数组  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'get_mimes'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Returns the MIME types array from config/mimes.php</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	array</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> &amp;<span class="title">get_mimes</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $_mimes;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($_mimes))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> (file_exists(APPPATH.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/mimes.php'</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				$_mimes = <span class="keyword">include</span>(APPPATH.<span class="string">'config/'</span>.ENVIRONMENT.<span class="string">'/mimes.php'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">elseif</span> (file_exists(APPPATH.<span class="string">'config/mimes.php'</span>))</span><br><span class="line">			&#123;</span><br><span class="line">				$_mimes = <span class="keyword">include</span>(APPPATH.<span class="string">'config/mimes.php'</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				$_mimes = <span class="keyword">array</span>();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> $_mimes;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="is-https"><a href="#is-https" class="headerlink" title="is_https"></a>is_https</h2><p>判断是佛通过加密访问<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'is_https'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Is HTTPS?</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Determines if the application is accessed via an encrypted</span></span><br><span class="line"><span class="comment">	 * (HTTPS) connection.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	bool</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">is_https</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ( ! <span class="keyword">empty</span>($_SERVER[<span class="string">'HTTPS'</span>]) &amp;&amp; strtolower($_SERVER[<span class="string">'HTTPS'</span>]) !== <span class="string">'off'</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_PROTO'</span>]) &amp;&amp; $_SERVER[<span class="string">'HTTP_X_FORWARDED_PROTO'</span>] === <span class="string">'https'</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">elseif</span> ( ! <span class="keyword">empty</span>($_SERVER[<span class="string">'HTTP_FRONT_END_HTTPS'</span>]) &amp;&amp; strtolower($_SERVER[<span class="string">'HTTP_FRONT_END_HTTPS'</span>]) !== <span class="string">'off'</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="is-cli"><a href="#is-cli" class="headerlink" title="is_cli"></a>is_cli</h2><p>判断是否由命令行运行<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'is_cli'</span>))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Is CLI?</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Test to see if a request was made from the command line.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 	bool</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">is_cli</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (PHP_SAPI === <span class="string">'cli'</span> <span class="keyword">OR</span> defined(<span class="string">'STDIN'</span>));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="show-error"><a href="#show-error" class="headerlink" title="show_error"></a>show_error</h2><p>错误处理程序  </p>
<p>这个函数允许我们调用异常类，使用application/views/errors/error_general.php下的标准错误模板显示错误  </p>
<p>此函数会将错误页面直接发送到浏览器并退出<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'show_error'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Error Handler</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * This function lets us invoke the exception class and</span></span><br><span class="line"><span class="comment">	 * display errors using the standard error template located</span></span><br><span class="line"><span class="comment">	 * in application/views/errors/error_general.php</span></span><br><span class="line"><span class="comment">	 * This function will send the error page directly to the</span></span><br><span class="line"><span class="comment">	 * browser and exit.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	int</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	void</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">show_error</span><span class="params">($message, $status_code = <span class="number">500</span>, $heading = <span class="string">'An Error Was Encountered'</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$status_code = abs($status_code);</span><br><span class="line">		<span class="keyword">if</span> ($status_code &lt; <span class="number">100</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			$exit_status = $status_code + <span class="number">9</span>; <span class="comment">// 9 is EXIT__AUTO_MIN</span></span><br><span class="line">			<span class="keyword">if</span> ($exit_status &gt; <span class="number">125</span>) <span class="comment">// 125 is EXIT__AUTO_MAX</span></span><br><span class="line">			&#123;</span><br><span class="line">				$exit_status = <span class="number">1</span>; <span class="comment">// EXIT_ERROR</span></span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			$status_code = <span class="number">500</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			$exit_status = <span class="number">1</span>; <span class="comment">// EXIT_ERROR</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记载异常类，都是通过该组件去管理错误</span></span><br><span class="line">		$_error =&amp; load_class(<span class="string">'Exceptions'</span>, <span class="string">'core'</span>);</span><br><span class="line">		<span class="keyword">echo</span> $_error-&gt;show_error($heading, $message, <span class="string">'error_general'</span>, $status_code);</span><br><span class="line">		<span class="keyword">exit</span>($exit_status);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="show-404"><a href="#show-404" class="headerlink" title="show_404"></a>show_404</h2><p>展示错误页面  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'show_404'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 404 Page Handler</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * This function is similar to the show_error() function above</span></span><br><span class="line"><span class="comment">	 * However, instead of the standard error template it displays</span></span><br><span class="line"><span class="comment">	 * 404 errors.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	bool</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	void</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">show_404</span><span class="params">($page = <span class="string">''</span>, $log_error = TRUE)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$_error =&amp; load_class(<span class="string">'Exceptions'</span>, <span class="string">'core'</span>);</span><br><span class="line">		$_error-&gt;show_404($page, $log_error);</span><br><span class="line">		<span class="keyword">exit</span>(<span class="number">4</span>); <span class="comment">// EXIT_UNKNOWN_FILE</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="log-message"><a href="#log-message" class="headerlink" title="log_message"></a>log_message</h2><p>调用Log组件记录log信息  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'log_message'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Error Logging Interface</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * We use this as a simple mechanism to access the logging</span></span><br><span class="line"><span class="comment">	 * class and send messages to be logged.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string	the error level: 'error', 'debug' or 'info'</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string	the error message</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	void</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">log_message</span><span class="params">($level, $message)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $_log;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> ($_log === <span class="keyword">NULL</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="comment">// references cannot be directly assigned to static variables, so we use an array</span></span><br><span class="line">			$_log[<span class="number">0</span>] =&amp; load_class(<span class="string">'Log'</span>, <span class="string">'core'</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		$_log[<span class="number">0</span>]-&gt;write_log($level, $message);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="set-status-header"><a href="#set-status-header" class="headerlink" title="set_status_header"></a>set_status_header</h2><p>设置http头信息  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'set_status_header'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Set HTTP Status Header</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	int	the status code</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	void</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">set_status_header</span><span class="params">($code = <span class="number">200</span>, $text = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (is_cli())</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($code) <span class="keyword">OR</span> ! is_numeric($code))</span><br><span class="line">		&#123;</span><br><span class="line">			show_error(<span class="string">'Status codes must be numeric'</span>, <span class="number">500</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 此函数构造一个响应头。$stati为响应码与其响应说明</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($text))</span><br><span class="line">		&#123;</span><br><span class="line">			is_int($code) <span class="keyword">OR</span> $code = (int) $code;</span><br><span class="line">			$stati = <span class="keyword">array</span>(</span><br><span class="line">				<span class="number">100</span>	=&gt; <span class="string">'Continue'</span>,</span><br><span class="line">				<span class="number">101</span>	=&gt; <span class="string">'Switching Protocols'</span>,</span><br><span class="line"></span><br><span class="line">				<span class="number">200</span>	=&gt; <span class="string">'OK'</span>,</span><br><span class="line">				<span class="number">201</span>	=&gt; <span class="string">'Created'</span>,</span><br><span class="line">				<span class="number">202</span>	=&gt; <span class="string">'Accepted'</span>,</span><br><span class="line">				<span class="number">203</span>	=&gt; <span class="string">'Non-Authoritative Information'</span>,</span><br><span class="line">				<span class="number">204</span>	=&gt; <span class="string">'No Content'</span>,</span><br><span class="line">				<span class="number">205</span>	=&gt; <span class="string">'Reset Content'</span>,</span><br><span class="line">				<span class="number">206</span>	=&gt; <span class="string">'Partial Content'</span>,</span><br><span class="line"></span><br><span class="line">				<span class="number">300</span>	=&gt; <span class="string">'Multiple Choices'</span>,</span><br><span class="line">				<span class="number">301</span>	=&gt; <span class="string">'Moved Permanently'</span>,</span><br><span class="line">				<span class="number">302</span>	=&gt; <span class="string">'Found'</span>,</span><br><span class="line">				<span class="number">303</span>	=&gt; <span class="string">'See Other'</span>,</span><br><span class="line">				<span class="number">304</span>	=&gt; <span class="string">'Not Modified'</span>,</span><br><span class="line">				<span class="number">305</span>	=&gt; <span class="string">'Use Proxy'</span>,</span><br><span class="line">				<span class="number">307</span>	=&gt; <span class="string">'Temporary Redirect'</span>,</span><br><span class="line"></span><br><span class="line">				<span class="number">400</span>	=&gt; <span class="string">'Bad Request'</span>,</span><br><span class="line">				<span class="number">401</span>	=&gt; <span class="string">'Unauthorized'</span>,</span><br><span class="line">				<span class="number">402</span>	=&gt; <span class="string">'Payment Required'</span>,</span><br><span class="line">				<span class="number">403</span>	=&gt; <span class="string">'Forbidden'</span>,</span><br><span class="line">				<span class="number">404</span>	=&gt; <span class="string">'Not Found'</span>,</span><br><span class="line">				<span class="number">405</span>	=&gt; <span class="string">'Method Not Allowed'</span>,</span><br><span class="line">				<span class="number">406</span>	=&gt; <span class="string">'Not Acceptable'</span>,</span><br><span class="line">				<span class="number">407</span>	=&gt; <span class="string">'Proxy Authentication Required'</span>,</span><br><span class="line">				<span class="number">408</span>	=&gt; <span class="string">'Request Timeout'</span>,</span><br><span class="line">				<span class="number">409</span>	=&gt; <span class="string">'Conflict'</span>,</span><br><span class="line">				<span class="number">410</span>	=&gt; <span class="string">'Gone'</span>,</span><br><span class="line">				<span class="number">411</span>	=&gt; <span class="string">'Length Required'</span>,</span><br><span class="line">				<span class="number">412</span>	=&gt; <span class="string">'Precondition Failed'</span>,</span><br><span class="line">				<span class="number">413</span>	=&gt; <span class="string">'Request Entity Too Large'</span>,</span><br><span class="line">				<span class="number">414</span>	=&gt; <span class="string">'Request-URI Too Long'</span>,</span><br><span class="line">				<span class="number">415</span>	=&gt; <span class="string">'Unsupported Media Type'</span>,</span><br><span class="line">				<span class="number">416</span>	=&gt; <span class="string">'Requested Range Not Satisfiable'</span>,</span><br><span class="line">				<span class="number">417</span>	=&gt; <span class="string">'Expectation Failed'</span>,</span><br><span class="line">				<span class="number">422</span>	=&gt; <span class="string">'Unprocessable Entity'</span>,</span><br><span class="line"></span><br><span class="line">				<span class="number">500</span>	=&gt; <span class="string">'Internal Server Error'</span>,</span><br><span class="line">				<span class="number">501</span>	=&gt; <span class="string">'Not Implemented'</span>,</span><br><span class="line">				<span class="number">502</span>	=&gt; <span class="string">'Bad Gateway'</span>,</span><br><span class="line">				<span class="number">503</span>	=&gt; <span class="string">'Service Unavailable'</span>,</span><br><span class="line">				<span class="number">504</span>	=&gt; <span class="string">'Gateway Timeout'</span>,</span><br><span class="line">				<span class="number">505</span>	=&gt; <span class="string">'HTTP Version Not Supported'</span></span><br><span class="line">			);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (<span class="keyword">isset</span>($stati[$code]))</span><br><span class="line">			&#123;</span><br><span class="line">				$text = $stati[$code];</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">			&#123;</span><br><span class="line">				show_error(<span class="string">'No status text available. Please check your status code number or supply your own message text.'</span>, <span class="number">500</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// php_sapi_name()方法可以获得PHP与服务器之间的接口类型</span></span><br><span class="line">		<span class="keyword">if</span> (strpos(PHP_SAPI, <span class="string">'cgi'</span>) === <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			header(<span class="string">'Status: '</span>.$code.<span class="string">' '</span>.$text, <span class="keyword">TRUE</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			$server_protocol = <span class="keyword">isset</span>($_SERVER[<span class="string">'SERVER_PROTOCOL'</span>]) ? $_SERVER[<span class="string">'SERVER_PROTOCOL'</span>] : <span class="string">'HTTP/1.1'</span>;</span><br><span class="line">			header($server_protocol.<span class="string">' '</span>.$code.<span class="string">' '</span>.$text, <span class="keyword">TRUE</span>, $code);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="error-handler、-exception-handler、-shutdown-handler"><a href="#error-handler、-exception-handler、-shutdown-handler" class="headerlink" title="_error_handler、_exception_handler、_shutdown_handler"></a>_error_handler、_exception_handler、_shutdown_handler</h2><p>错误处理机制  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'_error_handler'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Error Handler</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * This is the custom error handler that is declared at the (relative)</span></span><br><span class="line"><span class="comment">	 * top of CodeIgniter.php. The main reason we use this is to permit</span></span><br><span class="line"><span class="comment">	 * PHP errors to be logged in our own log files since the user may</span></span><br><span class="line"><span class="comment">	 * not have access to server logs. Since this function effectively</span></span><br><span class="line"><span class="comment">	 * intercepts PHP errors, however, we also need to display errors</span></span><br><span class="line"><span class="comment">	 * based on the current error_reporting level.</span></span><br><span class="line"><span class="comment">	 * We do that with the use of a PHP error template.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	int	$severity</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string	$message</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string	$filepath</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	int	$line</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	void</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">_error_handler</span><span class="params">($severity, $message, $filepath, $line)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$is_error = (((E_ERROR | E_COMPILE_ERROR | E_CORE_ERROR | E_USER_ERROR) &amp; $severity) === $severity);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// When an error occurred, set the status header to '500 Internal Server Error'</span></span><br><span class="line">		<span class="comment">// to indicate to the client something went wrong.</span></span><br><span class="line">		<span class="comment">// This can't be done within the $_error-&gt;show_php_error method because</span></span><br><span class="line">		<span class="comment">// it is only called when the display_errors flag is set (which isn't usually</span></span><br><span class="line">		<span class="comment">// the case in a production environment) or when errors are ignored because</span></span><br><span class="line">		<span class="comment">// they are above the error_reporting threshold.</span></span><br><span class="line">		<span class="keyword">if</span> ($is_error)</span><br><span class="line">		&#123;</span><br><span class="line">			set_status_header(<span class="number">500</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Should we ignore the error? We'll get the current error_reporting</span></span><br><span class="line">		<span class="comment">// level and add its bits with the severity bits to find out.</span></span><br><span class="line">		<span class="keyword">if</span> (($severity &amp; error_reporting()) !== $severity)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		$_error =&amp; load_class(<span class="string">'Exceptions'</span>, <span class="string">'core'</span>);</span><br><span class="line">		$_error-&gt;log_exception($severity, $message, $filepath, $line);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Should we display the error?</span></span><br><span class="line">		<span class="keyword">if</span> (str_ireplace(<span class="keyword">array</span>(<span class="string">'off'</span>, <span class="string">'none'</span>, <span class="string">'no'</span>, <span class="string">'false'</span>, <span class="string">'null'</span>), <span class="string">''</span>, ini_get(<span class="string">'display_errors'</span>)))</span><br><span class="line">		&#123;</span><br><span class="line">			$_error-&gt;show_php_error($severity, $message, $filepath, $line);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// If the error is fatal, the execution of the script should be stopped because</span></span><br><span class="line">		<span class="comment">// errors can't be recovered from. Halting the script conforms with PHP's</span></span><br><span class="line">		<span class="comment">// default error handling. See http://www.php.net/manual/en/errorfunc.constants.php</span></span><br><span class="line">		<span class="keyword">if</span> ($is_error)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">exit</span>(<span class="number">1</span>); <span class="comment">// EXIT_ERROR</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="remove-invisible-characters"><a href="#remove-invisible-characters" class="headerlink" title="remove_invisible_characters"></a>remove_invisible_characters</h2><p>删除不可见字符  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'remove_invisible_characters'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Remove Invisible Characters</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * This prevents sandwiching null characters</span></span><br><span class="line"><span class="comment">	 * between ascii characters, like Java\0script.</span></span><br><span class="line"><span class="comment">	 * 这可以防止夹空字符之间的ASCII字符，如java \ 0scrip</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	bool</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	string</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">remove_invisible_characters</span><span class="params">($str, $url_encoded = TRUE)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$non_displayables = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// every control character except newline (dec 10),</span></span><br><span class="line">		<span class="comment">// carriage return (dec 13) and horizontal tab (dec 09)</span></span><br><span class="line">		<span class="keyword">if</span> ($url_encoded)</span><br><span class="line">		&#123;</span><br><span class="line">			$non_displayables[] = <span class="string">'/%0[0-8bcef]/'</span>;	<span class="comment">// url encoded 00-08, 11, 12, 14, 15</span></span><br><span class="line">			$non_displayables[] = <span class="string">'/%1[0-9a-f]/'</span>;	<span class="comment">// url encoded 16-31</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		$non_displayables[] = <span class="string">'/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]+/S'</span>;	<span class="comment">// 00-08, 11, 12, 14-31, 127</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">do</span></span><br><span class="line">		&#123;</span><br><span class="line">			$str = preg_replace($non_displayables, <span class="string">''</span>, $str, <span class="number">-1</span>, $count);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">while</span> ($count);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> $str;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="html-escape"><a href="#html-escape" class="headerlink" title="html_escape"></a>html_escape</h2><p>返回HTML转义变量  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'html_escape'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Returns HTML escaped variable.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	mixed	$var		The input string or array of strings to be escaped.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	bool	$double_encode	$double_encode set to FALSE prevents escaping twice.</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	mixed			The escaped string or array of strings as a result.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">html_escape</span><span class="params">($var, $double_encode = TRUE)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($var))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> $var;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (is_array($var))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> array_map(<span class="string">'html_escape'</span>, $var, array_fill(<span class="number">0</span>, count($var), $double_encode));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> htmlspecialchars($var, ENT_QUOTES, config_item(<span class="string">'charset'</span>), $double_encode);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="stringify-attributes"><a href="#stringify-attributes" class="headerlink" title="_stringify_attributes"></a>_stringify_attributes</h2><p>在HTML标签中使用Stringify属性  </p>
<p>用于转换字符串、数组或对象的辅助函数的字符串的属性</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'_stringify_attributes'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Stringify attributes for use in HTML tags.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Helper function used to convert a string, array, or object</span></span><br><span class="line"><span class="comment">	 * of attributes to a string.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	mixed	string, array, object</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	bool</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	string</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">_stringify_attributes</span><span class="params">($attributes, $js = FALSE)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		$atts = <span class="keyword">NULL</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">empty</span>($attributes))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> $atts;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (is_string($attributes))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="string">' '</span>.$attributes;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		$attributes = (<span class="keyword">array</span>) $attributes;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">foreach</span> ($attributes <span class="keyword">as</span> $key =&gt; $val)</span><br><span class="line">		&#123;</span><br><span class="line">			$atts .= ($js) ? $key.<span class="string">'='</span>.$val.<span class="string">','</span> : <span class="string">' '</span>.$key.<span class="string">'="'</span>.$val.<span class="string">'"'</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> rtrim($atts, <span class="string">','</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="function-usable"><a href="#function-usable" class="headerlink" title="function_usable"></a>function_usable</h2><p>函数可用  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> ( ! function_exists(<span class="string">'function_usable'</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Function usable</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@link</span>	http://www.hardened-php.net/suhosin/</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span>	string	$function_name	Function to check for</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span>	bool	TRUE if the function exists and is safe to call,</span></span><br><span class="line"><span class="comment">	 *			FALSE otherwise.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">function_usable</span><span class="params">($function_name)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">static</span> $_suhosin_func_blacklist;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (function_exists($function_name))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span> ( ! <span class="keyword">isset</span>($_suhosin_func_blacklist))</span><br><span class="line">			&#123;</span><br><span class="line">				$_suhosin_func_blacklist = extension_loaded(<span class="string">'suhosin'</span>)</span><br><span class="line">					? explode(<span class="string">','</span>, trim(ini_get(<span class="string">'suhosin.executor.func.blacklist'</span>)))</span><br><span class="line">					: <span class="keyword">array</span>();</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> ! in_array($function_name, $_suhosin_func_blacklist, <span class="keyword">TRUE</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-07-18T15:45:13.101Z" itemprop="dateUpdated">2018-07-18 23:45:13</time>
</span><br>


        
        原文链接：<a href="/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/" target="_blank" rel="external">https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/</a>
        
    </div>
    <footer>
        <a href="https://pengwenwu.github.io">
            <img src="/img/avatar.jpg" alt="pengwenwu">
            pengwenwu
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CodeIgniter/">CodeIgniter</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PHP/">PHP</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/&title=《CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件》 — Pena's Blog&pic=https://pengwenwu.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/&title=《CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件》 — Pena's Blog&source=pengwenwu的个人博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件》 — Pena's Blog&url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/&via=https://pengwenwu.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/07/13/CI框架3-x源码阅读笔记二之核心文件CodeIgniter-php/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">CI框架3.x源码阅读笔记二之核心文件CodeIgniter.php</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'true' == 'true',
            appId: "U2qzDNI480QyyzN2kDGB7bGu-gzGzoHsz",
            appKey: "6o2PFFkLctFMxXg3qBrhr0CF",
            avatar: "retro",
            placeholder: "要不要说点什么？",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->




</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>pengwenwu &copy; 2017 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/&title=《CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件》 — Pena's Blog&pic=https://pengwenwu.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/&title=《CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件》 — Pena's Blog&source=pengwenwu的个人博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《CI框架3.x源码阅读笔记三之全局函数库文件Common.php文件》 — Pena's Blog&url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/&via=https://pengwenwu.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://pengwenwu.github.io/2018/07/18/CI框架3-x源码阅读笔记三之全局函数库文件Common-php文件/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD6klEQVR42u3aS27cMBAFwLn/pZ1tAkTye90k7EVpZYw9FFky0OrP5xNfX39dySfvf/m08o3vfm5cOHDgwIEjPmqyrfZ6umPOmhx4syYOHDhw4LjBkWz6/edNCHzne4+JOcf7Cjhw4MCB46c47qVheUh+Am33jwMHDhw4fg/HLEFKQmmegO0fJw4cOHDguMcxS7ryBOxUm6p9JBdrpThw4MCBY1J/GxYKf9vPV+Y7cODAgQNHXNTLk7F8fCFZYZ/mbcYvcODAgQPHnmN2+yRVyz+f3TEZiZix4sCBAweOPUdb8muHDDZ8yQBcG0qLsiAOHDhw4Bhx5MfeH6ltWW2aYbP94MCBAweODccmLOXlwtkwQfvb2cpFrRQHDhw4cMQcbUkuCXttOEz+fvNCMGw44cCBAweOEcestLdvI83u2L4K1JVRHDhw4MCx4MiLaLNP8m3NvrsP7fV/DQ4cOHDgKDlmDaHNCqdaWbPmUzTcgAMHDhw4DnG0SdRtlGRUbvYgceDAgQPHKY5Tgwt5+pccYDYANxt6eOzC4cCBAweOEUdbvDtVztu0uPLxhaQAWvficODAgQNHzHFqgCAPbG0quPlWUV7EgQMHDhzXOPIrT8zaENgO2OVn+SaFw4EDBw4cC45Nk6ltOOUFwaSweIMJBw4cOHBsOJLD7INxsmbbgmoLmsm9cODAgQPHnqNNwNowPAvk7SDFbP+P98KBAwcOHIc49oHzFFaepA3LfO9YOHDgwIFjwZEX79rftlW4dswiH3EYJm84cODAgeMQx34UYDZgl7e42pQsSREfAy0OHDhw4Cg52qGBNuzl5cVNitii1G0nHDhw4MARc7TJT3vU9xQrJ04StpZ1WBzEgQMHDhxx22k20HCq5NceI6EZPhIcOHDgwLHm2AS/PMVKwvYsOTwV4HHgwIEDxymOPLDNWkF5cfBUUlenbThw4MCB4xBHW7DbF/Xakl/+8DZvGf/USnHgwIEDx5ojbz61RcNTBcd8mG/4rpFUFnHgwIEDx4gjCXWbdOtU0rh5OShGGXDgwIEDx4hjFnfyK28gbe51YJwCBw4cOHCcmUwr2jZ5oJ3Btc2tVSkQBw4cOHBc4Pgqr3wT+bbaQer8JaAO2zhw4MCBY83Rhr3NONqsuXUqoO5Xw4EDBw4c+WptcG0P8M7RtrvyIDocEMeBAwcOHIc48kDVFgqLlk8QktvValAcOHDgwPFDHO2m8zJfG/7bwYjhlAcOHDhw4LjM0baRZmW+pMi42c9/PsGBAwcOHIc4ToW0vNWUj1Ykj6oFOlArxYEDBw4c64GGvKnTDrrla+bFys04BQ4cOHDgGHH8Aes8rpHepp/9AAAAAElFTkSuQmCC" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/js/main.min.js?v=1.7.1"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.7.1" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '死鬼去哪里了！';
            clearTimeout(titleTime);
        } else {
            document.title = '(つェ⊂)咦!又好了!';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
